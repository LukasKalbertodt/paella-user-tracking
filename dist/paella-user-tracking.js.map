{"version":3,"file":"paella-user-tracking.js","mappings":"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","sources":["webpack://paella-user-tracking/webpack/universalModuleDefinition","webpack://paella-user-tracking/./src/plugins/UserTrackingPlugins.js","webpack://paella-user-tracking/./src/plugins/es.upv.paella.analytics.userTrackingDataPlugin.js","webpack://paella-user-tracking/./src/plugins/es.upv.paella.debug.userTrackingDataPlugin.js","webpack://paella-user-tracking/./src/plugins/es.upv.paella.debugTag.userTrackingDataPlugin.js","webpack://paella-user-tracking/./src/plugins/es.upv.paella.matomo.userTrackingDataPlugin.js","webpack://paella-user-tracking/./src/plugins/es.upv.paella.userEventTracker.js","webpack://paella-user-tracking/./src/plugins/ sync \\.js","webpack://paella-user-tracking/external umd {\"commonjs\":\"paella-core\",\"commonjs2\":\"paella-core\",\"amd\":\"paella-core\"}","webpack://paella-user-tracking/webpack/bootstrap","webpack://paella-user-tracking/webpack/runtime/compat get default export","webpack://paella-user-tracking/webpack/runtime/define property getters","webpack://paella-user-tracking/webpack/runtime/hasOwnProperty shorthand","webpack://paella-user-tracking/webpack/runtime/make namespace object","webpack://paella-user-tracking/./src/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"paella-core\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"paella-core\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"paella-user-tracking\"] = factory(require(\"paella-core\"));\n\telse\n\t\troot[\"paella-user-tracking\"] = factory(root[undefined]);\n})(self, (__WEBPACK_EXTERNAL_MODULE__995__) => {\nreturn ","import {Â PluginModule } from \"paella-core\";\nimport packageData from \"../../package.json\";\n\nexport default class UserTrackingPlugins extends PluginModule {\n    get moduleName() {\n        return \"paella-user-tracking\";\n    }\n\n    get moduleVersion() {\n        return packageData.version;\n    }\n}","\nimport { DataPlugin  } from \"paella-core\";\n\nexport default class AnalyticsUserTrackingDataPlugin extends DataPlugin {\n    async load() {\n        const trackingId = this.config.trackingId;\n        const domain = this.config.domain || \"auto\";\n        if (trackingId) {\n            this.player.log.debug(\"Google Analytics Enabled\");\n            /* jshint ignore:start */\n            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n                (i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),\n                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n                })(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');\n            /* jshint ignore:end */\n            __gaTracker('create', trackingId, domain);\n            __gaTracker('send', 'pageview');\n        }\n        else {\n            this.player.log.debug(\"No Google Tracking ID found in config file. Disabling Google Analytics\");\n        }\n    }\n    \n    async write(context, { id }, data) {\n        if (this.config.category === undefined || this.config.category === true) {\n            const category = this.config.category || \"PaellaPlayer\";\n            const action = data.event;\n            const labelData = {\n                videoId: id,\n                plugin: data.plugin\n            }\n\n            try {\n                // Test if data parameters can be serialized\n                JSON.stringify(data.params);\n                labelData.params = data.params;\n            }\n            catch(e) {}\n\n            const label = JSON.stringify(labelData);\n\n            __gaTracker(' send', 'event', category, action, label);\n        }\n    }\n}","\nimport { DataPlugin } from 'paella-core';\n\nexport default class DebugUserTrackingDataPlugin extends DataPlugin {\n    async write(context, { id }, data) {\n        console.log(`id: ${ id }`, context, data);\n    }\n}\n","\nimport { DataPlugin } from 'paella-core';\n\nexport default class DebugTagTrackingDataPlugin extends DataPlugin {\n\n    async load() {\n        if (this.config.tagId) {\n            this._elem = document.getElementById(this.config.tagId);\n        }\n    }\n\n    async write(context, { id }, data) {\n        if (this._elem) {\n            this._elem.innerHTML += '<br/>' + id + \" \" + data.event;\n        }\n    }\n}","\nimport { DataPlugin, Events, bindEvent  } from \"paella-core\";\n\nexport default class MatomoUserTrackingDataPlugin extends DataPlugin {\n    \n    async isEnabled() {\n        if (!(await super.isEnabled())) {\n          return false;\n        }\n        else {\n            this.matomoGlobalLoaded = this.config.matomoGlobalLoaded ?? false;\n            this.server = this.config.server;\n            this.siteId = this.config.siteId;\n            this.events = this.config.events;\n            \n            if (!this.matomoGlobalLoaded && !(this.server && this.siteId)) {\n                this.player.log.warn('Matomo plugin: Plugin is enabled, but is not configured correctly. Please configue `matomoGlobalLoaded`, `server`and `siteId` parameters.');\n                return false;\n            }\n            return true;\n        }\n    }\n\n    async getCurrentUserId() {\n        return null;\n    }\n\n    async trackCustomDimensions() {\n        const templateVars = await this.getTemplateVars();\n        const customDimensions = this.config.customDimensions ?? {};\n\n        try {\n            Object.entries(customDimensions).forEach(([customDimensionId, customDimensionValueTemplate]) => {\n                const customDimensionValue = this.applyTemplate(customDimensionValueTemplate, templateVars);\n                _paq.push(['setCustomDimension', customDimensionId, customDimensionValue]);\n                this.player.log.debug(`Matomo plugin: setting custom dimension id=${customDimensionId} to '${customDimensionValue}'`);\n            });\n        }\n        catch(e) {            \n        }\n    }\n\n    async getTemplateVars(data) {\n        let eventData = this.getEventData(data);\n\n        return {\n            videoId: this.player._videoId,\n            metadata: this.player.videoManifest.metadata,\n            event: data?.event || '',\n            eventData: eventData\n        };\n    }\n\n    getEventData(data) {\n\n        switch (data?.event) {\n            case Events.SEEK:\n                return Math.round(data.params.newTime);\n            case Events.VOLUME_CHANGED:\n                return data.params.volume*100;\n            case Events.BUTTON_PRESS:\n                return data.params.plugin.name;\n            case Events.SHOW_POPUP:\n                return data.params.plugin.name;\n            case Events.HIDE_POPUP:\n                return data.params.plugin.name;\n            case Events.RESIZE_END:\n                return `${ data.params.size.w }x${ data.params.size.h }`;\n            case Events.LAYOUT_CHANGED:\n                return data.params.layoutId;\n            case Events.PLAYBACK_RATE_CHANGED:\n                return data.params.newPlaybackRate;\n            case Events.CAPTIONS_ENABLED:\n                return data.params.language;\n        }\n\n        return '';\n    }\n\n    async load() {\n        const heartBeatTime = this.config.heartBeatTime || 30;\n                \n        if (this.matomoGlobalLoaded) {\n            var _paq = window._paq = window._paq || [];\n            this.player.log.debug('Assuming Matomo analytics is initialized globaly.');\n            if (server) {\n                this.player.log.warn('Matomo plugin: `server` parameter is defined, but never used because Matomo is loaded globaly in the page. Is it an error? Please check it.');\n            }\n            if (siteId) {\n                this.player.log.warn('Matomo plugin: `siteId` parameter is defined, but never used because Matomo is loaded globaly in the page. Is it an error? Please check it.');\n            }\n        }\n        else {\n            const server = this.server;\n            const siteId = this.siteId;            \n            this.player.log.debug(\"Matomo analytics plugin enabled.\");\n            var _paq = window._paq = window._paq || [];\n            this.trackCustomDimensions();\n            const userId =  await this.getCurrentUserId();\n            if (userId) {\n                _paq.push(['setUserId', userId]);\n            }\n            _paq.push(['trackPageView']);\n            _paq.push(['enableLinkTracking']);\n            // accurately measure the time spent in the visit\n            _paq.push(['enableHeartBeatTimer', heartBeatTime]);\n            (function() {\n                var u=server;\n                _paq.push(['setTrackerUrl', u+'matomo.php']);\n                _paq.push(['setSiteId', siteId]);\n                var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];\n                g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);\n            })();\n        }\n        this.trackCustomDimensions();\n        // Scan For Media\n        bindEvent(this.player, Events.STREAM_LOADED, () => {\n            _paq.push(['MediaAnalytics::scanForMedia']);\n        });\n    }\n    \n    applyTemplate(txt, templateVars) {        \n        return txt.replace(/\\${[^{]*}/g, (t)=>{\n            return t.substring(2, t.length-1).split(\".\").reduce((a,b)=>{return a[b];}, templateVars)\n        });\n    };\n\n    async write(context, { id }, data) {\n        if (this.events) {\n            const categoryT = this.events.category || 'PaellaPlayer';\n            const actionT = this.events.action || '${event}';\n            const nameT = this.events.name || '${eventData}';\n\n            const templateVars = await this.getTemplateVars(data);\n\n            const category = this.applyTemplate(categoryT, templateVars);\n            const action = this.applyTemplate(actionT, templateVars);\n            const name = this.applyTemplate(nameT, templateVars);\n            \n            _paq.push(['trackEvent', category, action, name]);\n            this.player.log.debug(`Matomo plugin: track event category='${category}', action='${action}', name='${name}'`);\n        }\n    }\n}","import { Events, EventLogPlugin } from 'paella-core';\n\n//const eventKeys = Object.keys(Events);\n\nconst getPaellaEvents = (events) => events.map(eventName => Events[eventName]);\n\nexport default class UserEventTrackerPlugin extends EventLogPlugin {\n\tget events() {\n\t\tif (this.config.events) {\n\t\t\treturn getPaellaEvents(this.config.events);\n\t\t}\n\t\telse {\n\t\t\treturn [\n\t\t\t\tEvents.PLAY,\n\t\t\t\tEvents.PAUSE,\n\t\t\t\tEvents.SEEK,\n\t\t\t\tEvents.STOP,\n\t\t\t\tEvents.ENDED,\n\t\t\t\tEvents.FULLSCREEN_CHANGED,\n\t\t\t\tEvents.VOLUME_CHANGED,\n\t\t\t\tEvents.BUTTON_PRESS,\n\t\t\t\tEvents.RESIZE_END\n\t\t\t]\n\t\t}\n\t}\n\n\tasync onEvent(event, params) {\n\t\tconst id = this.player.videoId;\n\t\t// Remove plugin reference to avoid circular references\n\t\tif (params.plugin) {\n\t\t\tconst { name, config } = params.plugin;\n\t\t\tparams.plugin = { name, config }\n\t\t}\n\t\tconst trackingData = { event, params }\n\n\t\tswitch (event) {\n\t\tcase Events.SHOW_POPUP:\n\t\tcase Events.HIDE_POPUP:\n\t\tcase Events.BUTTON_PRESS:\n\t\t\ttrackingData.plugin = params.plugin?.name || null;\n\t\t}\n\n\t\tconst context = this.config.context || \"userTracking\";\n\t\tawait this.player.data.write(\n\t\t\tcontext,\n\t\t\t{ id },\n\t\t\ttrackingData\n\t\t);\n\t}\n}\n","var map = {\n\t\"./UserTrackingPlugins.js\": 263,\n\t\"./es.upv.paella.analytics.userTrackingDataPlugin.js\": 561,\n\t\"./es.upv.paella.debug.userTrackingDataPlugin.js\": 931,\n\t\"./es.upv.paella.debugTag.userTrackingDataPlugin.js\": 484,\n\t\"./es.upv.paella.matomo.userTrackingDataPlugin.js\": 685,\n\t\"./es.upv.paella.userEventTracker.js\": 11\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 757;","module.exports = __WEBPACK_EXTERNAL_MODULE__995__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\nimport GoogleAnalyticsUserTrackingData from './plugins/es.upv.paella.analytics.userTrackingDataPlugin';\nimport MatomoUserTrackingData from './plugins/es.upv.paella.matomo.userTrackingDataPlugin';\nimport DebugUserTrackingData from './plugins/es.upv.paella.debug.userTrackingDataPlugin';\nimport UserEventTracker from './plugins/es.upv.paella.userEventTracker';\n\nexport default function getUserTrackingPluginsContext() {\n    return require.context(\"./plugins\", true, /\\.js/)\n}\n\nexport const GoogleAnalyticsUserTrackingDataPlugin = GoogleAnalyticsUserTrackingData;\nexport const MatomoUserTrackingDataPlugin = MatomoUserTrackingData;\nexport const DebugUserTrackingDataPlugin = DebugUserTrackingData;\nexport const UserEventTrackerPlugin = UserEventTracker;\n"],"names":["root","factory","exports","module","require","define","amd","undefined","self","__WEBPACK_EXTERNAL_MODULE__995__","UserTrackingPlugins","PluginModule","i","AnalyticsUserTrackingDataPlugin","trackingId","this","config","domain","player","log","debug","s","o","g","r","a","m","q","push","arguments","l","Date","createElement","getElementsByTagName","async","src","parentNode","insertBefore","window","document","__gaTracker","context","data","id","category","action","event","labelData","videoId","plugin","JSON","stringify","params","e","label","DataPlugin","DebugUserTrackingDataPlugin","console","DebugTagTrackingDataPlugin","tagId","_elem","getElementById","innerHTML","MatomoUserTrackingDataPlugin","matomoGlobalLoaded","server","siteId","events","warn","getTemplateVars","templateVars","customDimensions","Object","entries","forEach","customDimensionId","customDimensionValueTemplate","customDimensionValue","applyTemplate","_paq","eventData","getEventData","_videoId","metadata","videoManifest","Events","Math","round","newTime","volume","name","size","w","h","layoutId","newPlaybackRate","language","heartBeatTime","trackCustomDimensions","getCurrentUserId","userId","u","d","type","bindEvent","txt","replace","t","substring","length","split","reduce","b","categoryT","actionT","nameT","UserEventTrackerPlugin","map","eventName","trackingData","write","EventLogPlugin","webpackContext","req","webpackContextResolve","__webpack_require__","Error","code","keys","resolve","__webpack_module_cache__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","definition","key","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","getUserTrackingPluginsContext","GoogleAnalyticsUserTrackingDataPlugin","GoogleAnalyticsUserTrackingData","MatomoUserTrackingData","DebugUserTrackingData","UserEventTracker"],"sourceRoot":""}